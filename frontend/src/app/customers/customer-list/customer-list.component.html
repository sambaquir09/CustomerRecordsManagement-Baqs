<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h2">Customer Management</h1>
    <button class="btn btn-primary" (click)="onAddCustomer()">
      <i class="bi bi-plus-circle me-2"></i>Add New Customer
    </button>
  </div>

  @if (error) {
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      {{ error }}
      <button type="button" class="btn-close" (click)="error = null"></button>
    </div>
  }

  <div class="card">
    <div class="card-body">
      @if (isLoading) {
        <div class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-2">Loading customers...</p>
        </div>
      } @else if (customers.length === 0) {
        <div class="text-center py-5">
          <i class="bi bi-inbox display-1 text-muted"></i>
          <p class="mt-3">No customers found</p>
        </div>
      } @else {
        <div class="table-responsive">
          <table class="table table-hover">
            <thead class="table-light">
              <tr>
                <th scope="col">ID</th>
                <th scope="col">First Name</th>
                <th scope="col">Last Name</th>
                <th scope="col">Email</th>
                <th scope="col">Contact Number</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              @for (customer of customers; track customer.id) {
                <tr>
                  <td>{{customer.id}}</td>
                  <td>
                    <a href="javascript:void(0)" class="text-decoration-none" (click)="onViewCustomer(customer)">
                      {{customer.first_name}}
                    </a>
                  </td>
                  <td>{{customer.last_name}}</td>
                  <td>{{customer.email}}</td>
                  <td>{{customer.contact_number}}</td>
                  <td>
                    <div class="btn-group btn-group-sm">
                      <button class="btn btn-outline-primary" (click)="onEditCustomer(customer)">
                        <i class="bi bi-pencil"></i> Edit
                      </button>
                      <button class="btn btn-outline-danger" (click)="onDeleteCustomer(customer)">
                        <i class="bi bi-trash"></i> Delete
                      </button>
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>

          @if (totalItems > 0) {
            <div class="d-flex justify-content-between align-items-center mt-3">
              <div class="text-muted">
                Showing {{(currentPage - 1) * itemsPerPage + 1}} to {{(currentPage * itemsPerPage) > totalItems ? totalItems : (currentPage * itemsPerPage)}} of {{totalItems}} entries
              </div>
              <nav aria-label="Page navigation">
                <ul class="pagination mb-0">
                  <li class="page-item" [class.disabled]="currentPage === 1">
                    <button class="page-link" (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1">
                      Previous
                    </button>
                  </li>
                  
                  @for (page of pageNumbers; track page) {
                    <li class="page-item" [class.active]="page === currentPage">
                      <button class="page-link" (click)="onPageChange(page)">{{page}}</button>
                    </li>
                  }
                  
                  <li class="page-item" [class.disabled]="currentPage === lastPage">
                    <button class="page-link" (click)="onPageChange(currentPage + 1)" [disabled]="currentPage === lastPage">
                      Next
                    </button>
                  </li>
                </ul>
              </nav>
            </div>
          }
        </div>
      }
    </div>
  </div>

  @if (showForm) {
    <app-modal [title]="isEditMode ? 'Edit Customer' : 'Add Customer'" (close)="closeForm()">
      <app-customer-form
        [customer]="selectedCustomer || { first_name: '', last_name: '', email: '', contact_number: '' }"
        [isEdit]="isEditMode"
        (submitForm)="onFormSubmit($event)"
        (cancelForm)="closeForm()"
      ></app-customer-form>
    </app-modal>
  }

  @if (showDetail) {
    <app-modal [title]="'Customer Details'" (close)="closeDetail()">
      <app-customer-detail
        [customer]="selectedCustomer!"
        (close)="closeDetail()"
        (edit)="onEditCustomer($event)"
      ></app-customer-detail>
    </app-modal>
  }

  @if (showDeleteConfirm) {
    <app-modal [title]="'Confirm Delete'" (close)="cancelDelete()">
      <div class="modal-body">
        <p>Are you sure you want to delete customer "{{selectedCustomer?.first_name}} {{selectedCustomer?.last_name}}"?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cancelDelete()">Cancel</button>
        <button type="button" class="btn btn-danger" (click)="confirmDelete()">Delete</button>
      </div>
    </app-modal>
  }
</div>
